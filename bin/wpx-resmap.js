#!/usr/bin/env node
"use strict";var _path=_interopRequireDefault(require("path")),_fs=_interopRequireDefault(require("fs")),_commander=require("commander"),_chalk=require("chalk"),_md=_interopRequireDefault(require("md5"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var resFolder,ResMap=/*#__PURE__*/function(){function a(b,c){_classCallCheck(this,a),this.folder=b,this.output=c}return _createClass(a,[{key:"walkSync",value:function d(a){var b,c=this;return _fs.default.statSync(a).isDirectory()?(b=Array.prototype).concat.apply(b,_toConsumableArray(_fs.default.readdirSync(a).map(function(b){return c.walkSync(_path.default.join(a,b))}))):a}},{key:"generate",value:function l(){var a=this,b=[],c=this.walkSync(this.folder),d=!0,e=!1,f=void 0;try{for(var g,h,i=c[Symbol.iterator]();!(d=(g=i.next()).done);d=!0){h=g.value;try{var j=_path.default.relative(_path.default.dirname(this.folder),h),k=(0,_md.default)(_fs.default.readFileSync(h));b.push({file:j,md5:k})}catch(a){console.error((0,_chalk.red)("Error: reading file `"+_path.default.join(this.folder,h)+"`, "+a)),process.exit(-1)}}}catch(a){e=!0,f=a}finally{try{d||null==i.return||i.return()}finally{if(e)throw f}}_fs.default.writeFile(this.output,JSON.stringify(b),function(b){b&&(console.error((0,_chalk.red)("Error: writing file `"+a.output+"`, "+b)),process.exit(-1)),console.log((0,_chalk.green)(a.output+" written successfully"))})}}]),a}(),program=new _commander.Command;program.arguments("[folder]").option("-o, --output [output]","Output file name").action(function(a){resFolder=a}).parse(process.argv),(null===resFolder||"undefined"==typeof resFolder)&&(console.error((0,_chalk.red)("Error: resource folder is no specified!")),process.exit(-1));var outputFileName=_path.default.basename(resFolder)+".map.json";program.output&&(outputFileName=_path.default.basename(program.output,_path.default.extname(program.output))+".map.json");try{var state=_fs.default.statSync(resFolder);state&&state.isDirectory||(console.error((0,_chalk.red)("Error: folder `"+resFolder+"` does not exist")),process.exit(-1))}catch(a){console.error((0,_chalk.red)("Error: `"+resFolder+"` is not a valid folder")),process.exit(-1)}var resmap=new ResMap(resFolder,outputFileName);resmap.generate();